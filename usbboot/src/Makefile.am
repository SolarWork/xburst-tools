AM_CFLAGS = -pedantic -Wall -Werror -O1 -g3 -std=gnu99 -lusb -lconfuse

xburst-tools_version.h:
	echo -e '#ifndef XBURST_TOOLS_VERSION' \
	'\n#define XBURST_TOOLS_VERSION "20090630-1"' \
	'\n#endif' > xburst-tools_version.h
BUILT_SOURCES = xburst-tools_version.h

bin_PROGRAMS = usbboot usbboot_server
usbboot_SOURCES = cmd.c command_line.c ingenic_cfg.c \
	ingenic_usb.c main.c nand.c mem.c

usbboot_server_SOURCES = cmd.c ingenic_cfg.c \
	ingenic_usb.c server.c nand.c mem.c

prefix = /usr
datadir = /usr/share/xburst-tools
data_DATA = ../xburst_stage1/xburst_stage1.bin \
	../xburst_stage2/xburst_stage2.bin

cfgdir = /etc/xburst-tools
cfg_DATA = ../doc/usbboot.cfg

EXTRA_DIST = $(datadir) $(cfgdir)

../xburst_stage1/xburst_stage1.bin:
	$(MAKE) CROSS_COMPILE=mipsel-openwrt-linux- -C ../xburst_stage1

../xburst_stage2/xburst_stage2.bin:
	$(MAKE) CROSS_COMPILE=mipsel-openwrt-linux- -C ../xburst_stage2
